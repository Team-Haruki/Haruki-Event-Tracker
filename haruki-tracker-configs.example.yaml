# ============================================================================
# This configuration file is generated by Claude Sonnet 4.5
# This project is licensed under the MIT License.
# For more information, see the LICENSE file in the project root.
# ============================================================================
# Haruki Event Tracker 配置文件
# Version: 2.0
# ============================================================================
# 说明：
# 1. 本文件为配置示例，请复制为 haruki-tracker-configs.yaml 后使用
# 2. 修改配置后需要重启服务才能生效
# ============================================================================

# ============================================================================
# Redis 配置
# ============================================================================
# 用途：缓存 API 返回的 Border 数据，避免重复记录相同的数据
# 注意：Redis 是必须的组件，请确保已正确安装并运行 Redis 服务器
redis:
  host: localhost            # Redis 服务器地址
  port: 6379                 # Redis 服务器端口
  password: ""               # Redis 密码（如无密码请留空）

# ============================================================================
# 后端 API 服务器配置
# ============================================================================
# 用途：提供 HTTP/HTTPS API 接口供前端或其他服务调用
backend:
  host: 0.0.0.0              # 监听地址（0.0.0.0 表示监听所有网络接口）
  port: 8080                 # 监听端口

  # SSL/HTTPS 配置
  ssl: false                 # 是否启用 HTTPS（生产环境建议启用）
  ssl_cert: ""               # SSL 证书文件路径（启用 SSL 时必填）
  ssl_key: ""                # SSL 私钥文件路径（启用 SSL 时必填）

  # 日志配置
  log_level: INFO            # 日志级别：DEBUG, INFO, WARN, ERROR, CRITICAL
  main_log_file: logs/haruki-tracker.log  # 主日志文件路径

  # 访问日志配置
  access_log: "${time} | ${status} | ${latency} | ${ip} | ${method} ${path}\n"  # 访问日志格式
  access_log_path: logs/access.log  # 访问日志文件路径（留空则输出到 stdout）

# ============================================================================
# Sekai API 配置
# ============================================================================
# 用途：从 Haruki Sekai API 获取排名数据
# 注意：需要有效的 API Token 才能使用，但是如果是自建 Haruki Sekai API 则可能不需要
sekai_api:
  api_endpoint: ""  # API 端点地址
  api_token: "YOUR_API_TOKEN_HERE"  # API 访问令牌（请替换为实际的 Token）

# ============================================================================
# 服务器配置
# ============================================================================
# 说明：每个游戏服务器都有独立的配置
# 支持的服务器：jp（日服）、en（国际服）、tw（台服）、kr（韩服）、cn（国服）
servers:
  # ----------------------------------------------------------------------------
  # 日本服务器 (JP)
  # ----------------------------------------------------------------------------
  jp:
    enabled: false           # 是否启用该服务器的追踪（true/false）
    master_data_dir: Data/haruki-sekai-master/master  # 游戏 Master 数据目录路径

    # Cron 定时任务配置
    use_second_level_tracker_cron: true  # 是否使用秒级 Cron（支持每秒执行）
    tracker_cron: "*/5 * * * *"          # Cron 表达式（每 5 分钟执行一次）
                                          # 格式：分 时 日 月 周
                                          # 秒级格式（启用 use_second_level_tracker_cron）: 秒 分 时 日 月 周
                                          # 示例：
                                          #   "*/5 * * * *"      - 每 5 分钟
                                          #   "0 */1 * * *"      - 每小时整点
                                          #   "*/30 * * * * *"   - 每 30 秒（需启用秒级）

    # 数据库配置（GORM）
    gorm_config:
      enabled: true          # 是否启用数据库（禁用则不会记录数据）
      dialect: postgres      # 数据库类型：mysql, postgres, sqlite

      # 数据源名称（DSN）- 根据不同数据库类型格式不同：
      # PostgreSQL: "host=localhost port=5432 user=username password=your_password dbname=database_name sslmode=disable TimeZone=UTC"
      # MySQL:      "username:password@tcp(localhost:3306)/database_name?charset=utf8mb4&parseTime=True&loc=Local"
      # SQLite:     "file:./data.db?cache=shared&mode=rwc"
      dsn: "host=localhost port=5432 user=haruki_user password=YOUR_PASSWORD_HERE dbname=haruki_tracker_jp sslmode=disable TimeZone=UTC"

      # 连接池配置
      max_open_conns: 100    # 最大打开连接数（建议 10-100）
      max_idle_conns: 10     # 最大空闲连接数（建议为 max_open_conns 的 10%）
      conn_max_lifetime: 1h  # 连接最大生命周期（支持：1h, 30m, 3600s）

      # 性能优化配置
      prepare_stmt: true     # 是否使用预处理语句（提高性能，建议启用）
      disable_fk_migrate: true  # 迁移时是否禁用外键约束（提高性能）

      # 数据库日志配置
      logger:
        level: warn          # 日志级别：silent（无日志）, error, warn, info
        slow_threshold: 200ms  # 慢查询阈值（超过此时间的查询会被记录）
        ignore_record_not_found_error: true  # 是否忽略"记录未找到"错误
        colorful: false      # 是否启用彩色日志输出

      # 表命名策略
      naming:
        table_prefix: ""     # 表名前缀（如 "haruki_" 会使表名变为 haruki_event_147）
        singular_table: false  # 是否使用单数表名（false 则自动复数化）

  # ----------------------------------------------------------------------------
  # 国际服 (EN)
  # ----------------------------------------------------------------------------
  en:
    enabled: false           # 是否启用国际服追踪
    master_data_dir: Data/haruki-sekai-master/master
    use_second_level_tracker_cron: true
    tracker_cron: "*/5 * * * *"  # 每 5 分钟执行一次
    gorm_config:
      enabled: true
      dialect: mysql         # 使用 MySQL 数据库
      dsn: "username:password@tcp(localhost:3306)/haruki_tracker_en?charset=utf8mb4&parseTime=True&loc=Local"
      max_open_conns: 100
      max_idle_conns: 10
      conn_max_lifetime: 1h
      prepare_stmt: true
      disable_fk_migrate: true
      logger:
        level: warn
        slow_threshold: 200ms
        ignore_record_not_found_error: true
        colorful: false
      naming:
        table_prefix: ""
        singular_table: false

  # ----------------------------------------------------------------------------
  # 台服 (TW)
  # ----------------------------------------------------------------------------
  tw:
    enabled: false           # 是否启用台服追踪
    master_data_dir: Data/haruki-sekai-master/master
    use_second_level_tracker_cron: true
    tracker_cron: "*/5 * * * *"
    gorm_config:
      enabled: true
      dialect: mysql
      dsn: "username:password@tcp(localhost:3306)/haruki_tracker_tw?charset=utf8mb4&parseTime=True&loc=Local"
      max_open_conns: 100
      max_idle_conns: 10
      conn_max_lifetime: 1h
      prepare_stmt: true
      disable_fk_migrate: true
      logger:
        level: warn
        slow_threshold: 200ms
        ignore_record_not_found_error: true
        colorful: false
      naming:
        table_prefix: ""
        singular_table: false

  # ----------------------------------------------------------------------------
  # 韩服 (KR)
  # ----------------------------------------------------------------------------
  kr:
    enabled: false           # 是否启用韩服追踪
    master_data_dir: Data/haruki-sekai-master/master
    use_second_level_tracker_cron: true
    tracker_cron: "*/5 * * * *"
    gorm_config:
      enabled: true
      dialect: mysql
      dsn: "username:password@tcp(localhost:3306)/haruki_tracker_kr?charset=utf8mb4&parseTime=True&loc=Local"
      max_open_conns: 100
      max_idle_conns: 10
      conn_max_lifetime: 1h
      prepare_stmt: true
      disable_fk_migrate: true
      logger:
        level: warn
        slow_threshold: 200ms
        ignore_record_not_found_error: true
        colorful: false
      naming:
        table_prefix: ""
        singular_table: false

  # ----------------------------------------------------------------------------
  # 国服 (CN)
  # ----------------------------------------------------------------------------
  cn:
    enabled: false           # 是否启用国服追踪（默认禁用，使用时请改为 true）
    master_data_dir: Data/haruki-sekai-sc-master/master  # 国服使用简体中文 Master 数据
    use_second_level_tracker_cron: true
    tracker_cron: "*/10 * * * * *"  # 每 10 秒执行一次（秒级 Cron）
    gorm_config:
      enabled: true
      dialect: postgres      # 使用 PostgreSQL 数据库
      dsn: "host=localhost port=5432 user=haruki_user password=YOUR_PASSWORD_HERE dbname=haruki_tracker_cn sslmode=disable TimeZone=Asia/Shanghai"
      max_open_conns: 100
      max_idle_conns: 10
      conn_max_lifetime: 1h
      prepare_stmt: true
      disable_fk_migrate: true
      logger:
        level: warn
        slow_threshold: 200ms
        ignore_record_not_found_error: true
        colorful: false
      naming:
        table_prefix: ""
        singular_table: false

# ============================================================================
# 配置说明
# ============================================================================
#
# 1. Cron 表达式说明：
#    - 标准 Cron（5 字段）：分 时 日 月 周
#      示例："0 */2 * * *" 表示每 2 小时的整点执行
#    - 秒级 Cron（6 字段，需启用 use_second_level_tracker_cron）：秒 分 时 日 月 周
#      示例："*/30 * * * * *" 表示每 30 秒执行
#
# 2. 数据库 DSN 配置示例：
#    PostgreSQL:
#      "host=localhost port=5432 user=myuser password=mypass dbname=mydb sslmode=disable TimeZone=UTC"
#    MySQL:
#      "myuser:mypass@tcp(localhost:3306)/mydb?charset=utf8mb4&parseTime=True&loc=Local"
#    SQLite:
#      "file:./tracker.db?cache=shared&mode=rwc"
#
# 3. 时区设置：
#    - PostgreSQL 使用 TimeZone 参数：TimeZone=Asia/Shanghai
#    - MySQL 使用 loc 参数：loc=Asia%2FShanghai
#
# 4. 性能调优建议：
#    - 高并发场景：增加 max_open_conns 到 200-500
#    - 低负载场景：减少 max_open_conns 到 10-50
#    - max_idle_conns 建议设置为 max_open_conns 的 10-20%
#
# 5. 日志级别选择：
#    - 开发环境：使用 info 或 warn
#    - 生产环境：使用 warn 或 error
#    - 调试问题：临时使用 info 或 debug
#
# ============================================================================

